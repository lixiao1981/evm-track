# ç»Ÿä¸€é…ç½®åŠ è½½å’ŒéªŒè¯ç³»ç»Ÿ

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### 1. ç»Ÿä¸€é…ç½®åŠ è½½å™¨ (ConfigLoader)
- **å¤šæ ¼å¼æ”¯æŒ**: è‡ªåŠ¨æ£€æµ‹å¹¶æ”¯æŒ JSON å’Œ TOML é…ç½®æ–‡ä»¶
- **æ™ºèƒ½è§£æ**: æ ¹æ®æ–‡ä»¶æ‰©å±•åé€‰æ‹©åˆé€‚çš„è§£æå™¨ï¼Œæ— æ‰©å±•åæ—¶è‡ªåŠ¨å°è¯•ä¸¤ç§æ ¼å¼
- **åŠ¨ä½œç‰¹å®šé…ç½®**: æ”¯æŒä¸ºç‰¹å®šåŠ¨ä½œåŠ è½½ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶
- **çµæ´»æ–‡ä»¶å‘½å**: æ”¯æŒå¤šç§é…ç½®æ–‡ä»¶å‘½åæ¨¡å¼

### 2. é…ç½®éªŒè¯å™¨ (ConfigValidator)
- **ä¸»é…ç½®éªŒè¯**: éªŒè¯RPC URLæ ¼å¼å’ŒåŠ¨ä½œé…ç½®å®Œæ•´æ€§
- **åœ°å€æ ¼å¼éªŒè¯**: è‡ªåŠ¨éªŒè¯æ‰€æœ‰ä»¥å¤ªåŠåœ°å€æ ¼å¼
- **åŠ¨ä½œç‰¹å®šéªŒè¯**: é’ˆå¯¹ä¸åŒåŠ¨ä½œç±»å‹çš„ä¸“é—¨éªŒè¯è§„åˆ™
- **é…ç½®å®Œæ•´æ€§æ£€æŸ¥**: è·¨åŠ¨ä½œä¾èµ–å…³ç³»éªŒè¯

### 3. é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- **è¯¦ç»†é”™è¯¯ä¿¡æ¯**: æ˜ç¡®æŒ‡å‡ºé…ç½®é—®é¢˜çš„å…·ä½“ä½ç½®å’ŒåŸå› 
- **ç»“æ„åŒ–æ—¥å¿—**: ä½¿ç”¨ tracing æä¾›è°ƒè¯•å’Œä¿¡æ¯æ—¥å¿—
- **ä¼˜é›…é™çº§**: åˆç†çš„é»˜è®¤å€¼å’Œè­¦å‘Šæœºåˆ¶

## ğŸ“‹ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬é…ç½®åŠ è½½
```rust
use evm_track::config::load_and_validate_config;
use std::path::Path;

let config = load_and_validate_config(Path::new("config.json"))?;
```

### åŠ¨ä½œç‰¹å®šé…ç½®åŠ è½½
```rust
use evm_track::config::ConfigLoader;

let action_config = ConfigLoader::load_action_config::<MyActionConfig>(
    "transfer", 
    Some(Path::new("./configs/"))
)?;
```

### æ‰‹åŠ¨éªŒè¯
```rust
use evm_track::config::ConfigValidator;

// éªŒè¯ä¸»é…ç½®
ConfigValidator::validate_main_config(&config)?;

// éªŒè¯é…ç½®å®Œæ•´æ€§
ConfigValidator::validate_config_integrity(&config)?;

// éªŒè¯ç‰¹å®šåŠ¨ä½œ
ConfigValidator::validate_action_config("transfer", &action_config)?;
```

## ğŸ”§ é…ç½®æ–‡ä»¶æ ¼å¼

### JSON æ ¼å¼ (æ¨è)
```json
{
  "rpcurl": "https://rpc.ankr.com/eth",
  "max-requests-per-second": 10,
  "event_sigs_path": "./data/event_sigs.json",
  "func_sigs_path": "./data/func_sigs.json",
  "actions": {
    "transfer": {
      "enabled": true,
      "addresses": {
        "0xA0b86a33E6418de4bE4C96D4c3c1EbcDFf0aA78E": {},
        "0xdAC17F958D2ee523a2206206994597C13D831ec7": {}
      },
      "options": {
        "min_amount": "1000000000000000000"
      }
    }
  }
}
```

### TOML æ ¼å¼
```toml
rpcurl = "https://rpc.ankr.com/eth"
max-requests-per-second = 15

[actions.transfer]
enabled = true
[actions.transfer.options]
min_amount = "500000000000000000"
[actions.transfer.addresses]
"0xA0b86a33E6418de4bE4C96D4c3c1EbcDFf0aA78E" = {}
```

## âš¡ éªŒè¯è§„åˆ™

### RPC URL éªŒè¯
- å¿…é¡»ä»¥ `http://`, `https://`, `ws://`, æˆ– `wss://` å¼€å¤´
- ä¸èƒ½ä¸ºç©ºå­—ç¬¦ä¸²

### åœ°å€éªŒè¯
- æ‰€æœ‰åœ°å€å¿…é¡»æ˜¯æœ‰æ•ˆçš„ä»¥å¤ªåŠåœ°å€æ ¼å¼
- è‡ªåŠ¨éªŒè¯ `addresses` æ˜ å°„ä¸­çš„æ‰€æœ‰é”®

### åŠ¨ä½œç‰¹å®šéªŒè¯
- **transfer**: `min_amount` å¿…é¡»æ˜¯æœ‰æ•ˆæ•°å­—
- **large_transfer**: `threshold` å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ­£æ•°ï¼ˆæ”¯æŒå¤§æ•°å€¼ï¼‰
- **ownership**: è‡³å°‘éœ€è¦ä¸€ä¸ªåˆçº¦åœ°å€
- **deployment**: å¯ä»¥æ²¡æœ‰åœ°å€ï¼ˆç›‘æ§æ‰€æœ‰éƒ¨ç½²ï¼‰

### å®Œæ•´æ€§éªŒè¯
- æ£€æŸ¥åŠ¨ä½œé—´çš„ä¾èµ–å…³ç³»
- ä¾‹å¦‚ï¼šå¯ç”¨ `large_transfer` æ—¶å»ºè®®åŒæ—¶å¯ç”¨ `transfer`

## ğŸ¯ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç±»å‹
1. **é…ç½®æ–‡ä»¶ä¸å­˜åœ¨**: `Configuration file not found`
2. **æ ¼å¼é”™è¯¯**: `Invalid JSON/TOML in file`
3. **åœ°å€æ ¼å¼é”™è¯¯**: `Invalid address 'xxx' in action 'yyy'`
4. **å‚æ•°éªŒè¯å¤±è´¥**: `Invalid threshold in large_transfer config`

### é”™è¯¯ä¿¡æ¯ç‰¹ç‚¹
- æ˜ç¡®æŒ‡å‡ºé—®é¢˜çš„å…·ä½“ä½ç½®
- æä¾›ä¿®å¤å»ºè®®
- åŒ…å«å®Œæ•´çš„é”™è¯¯è·¯å¾„

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ç³»ç»Ÿè¿ç§»
æ‰€æœ‰ä½¿ç”¨ `config::load_config()` çš„åœ°æ–¹å·²è‡ªåŠ¨æ›´æ–°ä¸º `config::load_and_validate_config()`ï¼š

- `src/main.rs`: HistoryTxScan å‘½ä»¤
- `src/commands/track.rs`: Realtime å’Œ Historical å‘½ä»¤
- `src/commands/init_scan_cmd.rs`: InitScan å‘½ä»¤

### æ€§èƒ½æ”¹è¿›
- **è‡ªåŠ¨éªŒè¯**: é…ç½®åŠ è½½æ—¶è‡ªåŠ¨è¿›è¡Œå…¨é¢éªŒè¯
- **æ—©æœŸé”™è¯¯æ£€æµ‹**: å¯åŠ¨æ—¶å‘ç°é…ç½®é—®é¢˜ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
- **å¤šæ ¼å¼æ”¯æŒ**: æ— éœ€æ‰‹åŠ¨é€‰æ‹©è§£æå™¨

## ğŸ“Š æµ‹è¯•è¦†ç›–

### æµ‹è¯•ç”¨ä¾‹
1. **åŸºæœ¬åŠŸèƒ½æµ‹è¯•**: `examples/test_config_system.rs`
2. **TOML æ”¯æŒæµ‹è¯•**: `examples/test_toml_config.rs`
3. **é”™è¯¯å¤„ç†æµ‹è¯•**: æ— æ•ˆé…ç½®æ–‡ä»¶å’Œæ ¼å¼é”™è¯¯

### è¿è¡Œæµ‹è¯•
```bash
cargo run --example test_config_system
cargo run --example test_toml_config
```

## ğŸ‰ æ¶æ„ä¼˜åŠ¿

### 1. ç»Ÿä¸€æ€§
- æ‰€æœ‰é…ç½®åŠ è½½ä½¿ç”¨ç›¸åŒçš„æ¥å£å’ŒéªŒè¯æµç¨‹
- æ¶ˆé™¤äº†ä»£ç é‡å¤å’Œä¸ä¸€è‡´çš„å¤„ç†æ–¹å¼

### 2. å¯æ‰©å±•æ€§
- æ˜“äºæ·»åŠ æ–°çš„é…ç½®éªŒè¯è§„åˆ™
- æ”¯æŒæ–°çš„é…ç½®æ–‡ä»¶æ ¼å¼
- æ¨¡å—åŒ–çš„éªŒè¯å™¨è®¾è®¡

### 3. å¥å£®æ€§
- å…¨é¢çš„é”™è¯¯å¤„ç†å’ŒéªŒè¯
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œä¿®å¤å»ºè®®
- é…ç½®å®Œæ•´æ€§æ£€æŸ¥é˜²æ­¢é…ç½®å†²çª

### 4. å¼€å‘è€…å‹å¥½
- ä¸°å¯Œçš„æ—¥å¿—è¾“å‡ºä¾¿äºè°ƒè¯•
- çµæ´»çš„é…ç½®æ–‡ä»¶å‘½åæ”¯æŒ
- å‘åå…¼å®¹ç°æœ‰é…ç½®æ–‡ä»¶

è¿™ä¸ªç»Ÿä¸€é…ç½®ç³»ç»Ÿæ˜¾è‘—æé«˜äº†é¡¹ç›®çš„é…ç½®ç®¡ç†è´¨é‡ï¼Œä¸ºåç»­çš„åŠŸèƒ½æ‰©å±•æä¾›äº†åšå®çš„åŸºç¡€ã€‚
